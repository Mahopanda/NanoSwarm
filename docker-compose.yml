x-common: &common
  build: .
  volumes:
    - "${NANOSWARM_HOME:-~/.nanoswarm}:/home/bun/.nanoswarm"

services:
  gateway:
    <<: *common
    ports:
      - "${PORT:-4000}:4000"
    command: ["gateway"]
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: "1"
          memory: 1G
        reservations:
          cpus: "0.25"
          memory: 256M

  cli:
    <<: *common
    profiles: ["cli"]
    stdin_open: true
    tty: true
    command: ["status"]
